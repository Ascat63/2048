const express = require('express');
const fs = require('fs');
const app = express();
const PORT = 3000;

app.use(express.json());

let knowledgeBase = {};

// Cargar base de conocimientos
if (fs.existsSync('knowledgeBase.json')) {
    knowledgeBase = JSON.parse(fs.readFileSync('knowledgeBase.json', 'utf-8'));
}

app.post('/chat', (req, res) => {
    const { message } = req.body;

    // Responder o aprender
    const reply = knowledgeBase[message.toLowerCase()] || "No entiendo eso. ¿Cómo debería responder?";
    if (!knowledgeBase[message.toLowerCase()]) {
        knowledgeBase[message.toLowerCase()] = reply;
        fs.writeFileSync('knowledgeBase.json', JSON.stringify(knowledgeBase, null, 2));
    }

    res.json({ reply });
});

app.listen(PORT, () => {
    console.log(`Servidor corriendo en http://localhost:${PORT}`);
});
